state_fips
state_data <- merge(state_fips, total_data)
state_data
state_fips
total_data
names(total_data)
names(total_data)[1] <- "abb"
data(state.fips)
state_fips <- select(state.fips, fips, abb) %>%
distinct(fips, abb) %>%
rbind(data.frame(fips = c(02, 15),
abb = c("AK", "HI")))
state_data <- merge(state_fips, total_data)
state_data
write.csv(state_data, "state_data.csv", row.names = FALSE)
names(state_data)
names(state_data)[c(2, 3)]
names(state_data)[c(2, 3)] <- c("id", "rate")
write.csv(state_data, "state_data.csv", row.names = FALSE)
plot(density(state_data$rate, na.rm = TRUE))
sd_score <- sd(state_data$rate, na.rm = TRUE)
sd_score
round(c(-2 * sd_score, -1 * sd_score, 0, 1 * sd_score, 2 * sd_score) + mean(foo$rate, na.rm = TRUE), 2)
round(c(-2 * sd_score, -1 * sd_score, 0, 1 * sd_score, 2 * sd_score) + mean(state_data$rate, na.rm = TRUE), 2)
names(state_data)
state_data <- merge(state_fips, total_data)
names(state_data)[c(1, 2, 3)] <- c("name", "id", "rate")
write.csv(state_data, "state_data.csv", row.names = FALSE)
write.csv(state_data[, -4], "state_data.csv", row.names = FALSE)
round(c(-2 * sd_score, -1 * sd_score, 0, 1 * sd_score, 2 * sd_score) + mean(state_data$rate, na.rm = TRUE), 2)
write.csv(state_data, "state_data.csv", row.names = FALSE)
total_data
head(do.call(rbind, new_data))
total_data <- do.call(rbind, new_data) %>%
group_by(STATE, year) %>%
summarise(mean_IAT = round(mean(IAT), 2),
N = n()) %>%
filter(!(STATE %in% c("AE", "AP", "PR")) & N > 100)
51 * 10
total_data <- do.call(rbind, new_data) %>%
group_by(STATE, year) %>%
summarise(mean_IAT = round(mean(IAT), 2),
N = n()) %>%
filter(!(STATE %in% c("AE", "AP", "PR")) > 20)
51 * 10
51 * 11
51 * 12
total_data <- do.call(rbind, new_data) %>%
group_by(STATE, year) %>%
summarise(mean_IAT = round(mean(IAT), 2),
N = n()) %>%
filter(!(STATE %in% c("AE", "AP", "PR")) & N > 100)
total_data
data(state.fips)
state_fips <- select(state.fips, fips, abb) %>%
distinct(fips, abb) %>%
rbind(data.frame(fips = c(02, 15),
abb = c("AK", "HI")))
state_data <- merge(state_fips, total_data)
names(state_data)[c(1, 2, 3)] <- c("name", "id", "rate")
head(state_data)
head(state_data$year)
unique(state_data$year)
write.csv(filter(state_data, year == 2004), "state_data.csv", row.names = FALSE)
filter(state_data, year == 2004)
state_fips
total_data
names(total_data)[1] <- "abb"
data(state.fips)
state_fips <- select(state.fips, fips, abb) %>%
distinct(fips, abb) %>%
rbind(data.frame(fips = c(02, 15),
abb = c("AK", "HI")))
state_data <- merge(state_fips, total_data)
names(state_data)[c(1, 2, 3)] <- c("name", "id", "rate")
state_data
filter(state_data, year == 2004)
state_data
filter(state_data, year == 2004)
str(state_data)
state_data
state_data <- merge(state_fips, total_data)
names(state_data)
names(state_data)[c(1, 2, 4)] <- c("name", "id", "rate")
write.csv(filter(state_data, year == 2004), "state_data.csv", row.names = FALSE)
filter(state_data, year == 2004)
write.csv(filter(state_data, year == 2005), "state_data.csv", row.names = FALSE)
write.csv(filter(state_data, year == 2006), "state_data.csv", row.names = FALSE)
write.csv(filter(state_data, year == 2007), "state_data.csv", row.names = FALSE)
write.csv(filter(state_data, year == 2008), "state_data.csv", row.names = FALSE)
write.csv(filter(state_data, year == 2009), "state_data.csv", row.names = FALSE)
write.csv(filter(state_data, year == 2010), "state_data.csv", row.names = FALSE)
write.csv(filter(state_data, year == 2011), "state_data.csv", row.names = FALSE)
write.csv(filter(state_data, year == 2012), "state_data.csv", row.names = FALSE)
write.csv(filter(state_data, year == 2013), "state_data.csv", row.names = FALSE)
state.name
state.abb
data.frame(state.name, state.abb)
head(state_data)
total_data <- do.call(rbind, new_data) %>%
group_by(STATE) %>%
summarise(mean_IAT = round(mean(IAT), 2),
N = n()) %>%
filter(!(STATE %in% c("AE", "AP", "PR")) & N > 100)
names(total_data)[1] <- "abb"
total_data
data(state.fips)
state_fips <- select(state.fips, fips, abb) %>%
distinct(fips, abb) %>%
rbind(data.frame(fips = c(02, 15),
abb = c("AK", "HI")))
state_data <- merge(state_fips, total_data)
state_data
state.name
state.abb
data.frame(state.name, state.abb)
state_data
arrange(data.frame(state.name, state.abb), state.abb)
names(state_data)[c(1, 2, 4)] <- c("name", "id", "rate")
data.frame(state.name, state.abb) %>%
arrange(state.abb) %>%
select(state.name)
state_data <- merge(state_fips, total_data)
names(state_data)[c(2, 4)] <- c("id", "rate")
state_data$name <- data.frame(state.name, state.abb) %>%
arrange(state.abb) %>%
select(state.name)
data.frame(state.name, state.abb)
data.frame(state.name, state.abb) %>%
rbind(c("District of Columbia", "DC"))
arrange(state.abb)
data.frame(as.character(state.name), as.character(state.abb)) %>%
rbind(c("District of Columbia", "DC"))
data.frame(as.character(state.name), as.character(state.abb))
foo <- data.frame(as.character(state.name), as.character(state.abb))
str(foo)
?data.frame
data.frame(state.name, state.abb, stringsAsFactors = FALSE) %>%
rbind(c("District of Columbia", "DC"))
data.frame(state.name, state.abb, stringsAsFactors = FALSE) %>%
rbind(c("District of Columbia", "DC")) %>%
arrange(state.abb)
state_data$name <- data.frame(state.name, state.abb, stringsAsFactors = FALSE) %>%
rbind(c("District of Columbia", "DC")) %>%
arrange(state.abb) %>%
select(state.name)
state_data
state_data
plot(density(state_data$rate, na.rm = TRUE))
state_data
state_data <- merge(state_fips, total_data)
names(state_data)
names(state_data)[c(2, 3)] <- c("id", "rate")
state_data$name <- data.frame(state.name, state.abb, stringsAsFactors = FALSE) %>%
rbind(c("District of Columbia", "DC")) %>%
arrange(state.abb) %>%
select(state.name)
write.csv(state_data, "new_data.csv", row.names = FALSE)
plot(density(state_data$rate, na.rm = TRUE))
sd_score <- sd(state_data$rate, na.rm = TRUE)
round(c(-2 * sd_score, -1 * sd_score, 0, 1 * sd_score, 2 * sd_score) + mean(state_data$rate, na.rm = TRUE), 2)
state_data
names(state_data)
state_data
names(state_data)[5] <- "name"
state_data
str(state_data)
data.frame(state.name, state.abb, stringsAsFactors = FALSE) %>%
rbind(c("District of Columbia", "DC")) %>%
arrange(state.abb) %>%
select(state.name) %>%
as.vector()
state_data$name <- data.frame(state.name, state.abb, stringsAsFactors = FALSE) %>%
rbind(c("District of Columbia", "DC")) %>%
arrange(state.abb) %>%
select(state.name) %>%
as.vector()
str(state_data)
data.frame(state.name, state.abb, stringsAsFactors = FALSE) %>%
rbind(c("District of Columbia", "DC")) %>%
arrange(state.abb) %>%
.$state.name
state_data$name <- data.frame(state.name, state.abb, stringsAsFactors = FALSE) %>%
rbind(c("District of Columbia", "DC")) %>%
arrange(state.abb) %>%
.$state.name
names(state_data)[5] <- "name"
str(state_data)
write.csv(state_data, "new_data.csv", row.names = FALSE)
total_data <- do.call(rbind, new_data) %>%
group_by(STATE) %>%
summarise(mean_IAT = round(mean(IAT), 2),
size = n()) %>%
filter(!(STATE %in% c("AE", "AP", "PR")) & N > 100)
names(total_data)[1] <- "abb"
data(state.fips)
state_fips <- select(state.fips, fips, abb) %>%
distinct(fips, abb) %>%
rbind(data.frame(fips = c(02, 15),
abb = c("AK", "HI")))
state_data <- merge(state_fips, total_data)
names(state_data)[c(2, 3)] <- c("id", "rate")
state_data
total_data <- do.call(rbind, new_data) %>%
group_by(STATE) %>%
summarise(mean_IAT = round(mean(IAT), 2),
size = n()) %>%
filter(!(STATE %in% c("AE", "AP", "PR")) & N > 100)
names(total_data)[1] <- "abb"
data(state.fips)
state_fips <- select(state.fips, fips, abb) %>%
distinct(fips, abb) %>%
rbind(data.frame(fips = c(02, 15),
abb = c("AK", "HI")))
state_data <- merge(state_fips, total_data)
names(state_data)[c(2, 3)] <- c("id", "rate")
state_data$name <- data.frame(state.name, state.abb, stringsAsFactors = FALSE) %>%
rbind(c("District of Columbia", "DC")) %>%
arrange(state.abb) %>%
.$state.name
state_data
names(state_data)[4:5] <- c("size", "name")
state_data
write.csv(state_data, "new_data.csv", row.names = FALSE)
rm(list = ls())
library(foreign)
library(dplyr)
library(httr)
library(maps)
rm(list = ls())
library(foreign)
library(dplyr)
library(httr)
library(maps)
setwd("~/Documents/college stuffs/grad school/website/dpmartin42.github.io/projects/IAT_Map")
iat_links <- data.frame(Year = c("2004", "2005", "2006", "2007", "2008", "2009", "2010", "2011", "2012", "2013"),
Link = c("5rnzu", "vnimz", "hf9qt", "a7dkz", "fmbje", "gqw7d", "nzvy2", "taqhb", "rphks", "7phax"))
new_data <- list(NA)
for(the_year in 1:nrow(iat_links)){
df <- iat_links[the_year, ]
URL <- paste0("https://osf.io/", df$Link, "/?action=download")
file_name <- paste0("Race_IAT.public.", df$Year, ".zip" )
full_path <- paste0("Data/", file_name)
httr::GET(URL, httr::write_disk(full_path, overwrite = TRUE))
unzip(full_path, exdir = "Data/")
my_data <- read.spss(paste0("Data/", list.files("Data/")[grep(".sav", list.files("Data/"))]), use.value.labels = FALSE)
if(df$Year %in% c("2004", "2005")){
new_data[[the_year]] <- data.frame(IAT = my_data$D_biep.White_Good_all,
STATE = my_data$STATE,
CountyNo = my_data$CountyNo,
year = my_data$year,
race = as.character(my_data$ethnic)) %>%
filter(race == 5 & !is.na(IAT) & grepl("[A-Z]+", STATE))
} else{
new_data[[the_year]] <- data.frame(IAT = my_data$D_biep.White_Good_all,
STATE = my_data$STATE,
CountyNo = my_data$CountyNo,
year = my_data$year,
race = as.character(my_data$raceomb)) %>%
filter(race == 6 & !is.na(IAT) & grepl("[A-Z]+", STATE))
}
for(the_file in list.files("Data/")){
file.remove(paste0("Data/", the_file))
}
print(paste(the_year, "of 10 found"))
}
state_agg <- do.call(rbind, new_data) %>%
group_by(STATE) %>%
summarise(mean_IAT = round(mean(IAT), 2),
size = n()) %>%
filter(!(STATE %in% c("AE", "AP", "PR")) & N > 100)
names(state_agg)[1] <- "abb"
do.call(rbind, new_data) %>%
group_by(STATE) %>%
summarise(mean_IAT = round(mean(IAT), 2),
size = n())
state_agg <- do.call(rbind, new_data) %>%
group_by(STATE) %>%
summarise(mean_IAT = round(mean(IAT), 2),
size = n()) %>%
filter(!(STATE %in% c("AE", "AP", "PR")) & N > 100)
library(foreign)
library(dplyr)
library(httr)
library(maps)
state_agg <- do.call(rbind, new_data) %>%
group_by(STATE) %>%
summarise(mean_IAT = round(mean(IAT), 2),
size = n()) %>%
filter(!(STATE %in% c("AE", "AP", "PR")) & N > 100)
state_agg <- do.call(rbind, new_data) %>%
group_by(STATE) %>%
summarise(mean_IAT = round(mean(IAT), 2),
size = n()) %>%
filter(!(STATE %in% c("AE", "AP", "PR")) & size > 100)
names(state_agg)[1] <- "abb"
data(state.fips)
state_fips <- select(state.fips, fips, abb) %>%
distinct(fips, abb) %>%
rbind(data.frame(fips = c(02, 15),
abb = c("AK", "HI")))
state_data <- merge(state_fips, total_data)
state_data <- merge(state_fips, state_agg)
names(state_data)[c(2, 3)] <- c("id", "rate")
state_data$name <- data.frame(state.name, state.abb, stringsAsFactors = FALSE) %>%
rbind(c("District of Columbia", "DC")) %>%
arrange(state.abb) %>%
.$state.name
state_data
state_data <- merge(state_fips, state_agg)
names(state_data)[c(2, 3)] <- c("id", "rate")
state_data$name <- data.frame(state.name, state.abb, stringsAsFactors = FALSE) %>%
rbind(c("District of Columbia", "DC")) %>%
arrange(state.abb) %>%
.$state.name
state_data
state_data <- merge(state_fips, state_agg)
names(state_data)[c(2, 3)] <- c("id", "rate")
state_data$name <- data.frame(state.name, state.abb, stringsAsFactors = FALSE) %>%
rbind(c("District of Columbia", "DC")) %>%
arrange(state.abb) %>%
.$state.name
state_data
state_agg <- do.call(rbind, new_data) %>%
group_by(STATE) %>%
summarise(meanIAT = round(mean(IAT), 2),
size = n()) %>%
filter(!(STATE %in% c("AE", "AP", "PR")) & size > 100)
names(state_agg)[1] <- "abb"
# merge with fips code at the state level
data(state.fips)
state_fips <- select(state.fips, fips, abb) %>%
distinct(fips, abb) %>%
rbind(data.frame(fips = c(02, 15),
abb = c("AK", "HI")))
<- do.call(rbind, new_data) %>%
group_by(STATE) %>%
summarise(meanIAT = round(mean(IAT), 2),
size = n()) %>%
filter(!(STATE %in% c("AE", "AP", "PR")) & size > 100)
names(state_agg)[1] <- "abb"
# merge with fips code at the state level
data(state.fips)
state_fips <- select(state.fips, fips, abb) %>%
distinct(fips, abb) %>%
rbind(data.frame(fips = c(02, 15),
abb = c("AK", "HI")))
state_data <- merge(state_fips, state_agg)
names(state_data)[2] <- "id"
state_data$name <- data.frame(state.name, state.abb, stringsAsFactors = FALSE) %>%
rbind(c("District of Columbia", "DC")) %>%
arrange(state.abb) %>%
.$state.name
state_data
write.csv(state_data, "state_data.csv", row.names = FALSE)
plot(density(state_data$rate, na.rm = TRUE))
plot(density(state_data$meanIAT, na.rm = TRUE))
sd_score <- sd(state_data$meanIAT, na.rm = TRUE)
round(c(-2 * sd_score, -1 * sd_score, 0, 1 * sd_score, 2 * sd_score) + mean(state_data$meanIAT, na.rm = TRUE), 2)
county_agg <- do.call(rbind, new_data) %>%
group_by(STATE, CountyNo) %>%
summarise(mean_IAT = round(mean(IAT), 2),
N = n()) %>%
filter(!(STATE %in% c("AE", "AP", "PR")) & N > 30)
data(state.fips)
state_fips <- select(state.fips, fips, abb) %>%
distinct(fips, abb) %>%
rbind(data.frame(fips = c(02, 15),
abb = c("AK", "HI"))) %>%
arrange(fips)
county_fips <- left_join(county_agg, state_fips, by = c("STATE" = "abb")) %>%
mutate(id = paste0(as.character(fips), as.character(CountyNo)))
county_fips
state_fips <- select(state.fips, fips, abb) %>%
distinct(fips, abb) %>%
rbind(data.frame(fips = c(02, 15),
abb = c("AK", "HI"))) %>%
arrange(fips)
county_agg
state_fips
left_join(county_agg, state_fips, by = c("STATE" = "abb"))
county_agg <- do.call(rbind, new_data) %>%
group_by(STATE, CountyNo) %>%
summarise(mean_IAT = round(mean(IAT), 2),
N = n()) %>%
filter(!(STATE %in% c("AE", "AP", "PR", "AA")) & N > 30)
county_agg
data(state.fips)
state_fips <- select(state.fips, fips, abb) %>%
distinct(fips, abb) %>%
rbind(data.frame(fips = c(02, 15),
abb = c("AK", "HI"))) %>%
arrange(fips)
county_fips <- left_join(county_agg, state_fips, by = c("STATE" = "abb")) %>%
mutate(id = paste0(as.character(fips), as.character(CountyNo)))
county_fips
county_names <- read.csv("county_names.csv")
county_total <- merge(county_names, county_fips, all.x = TRUE) %>%
select(id, name, mean_IAT)
names(county_total)
county_agg <- do.call(rbind, new_data) %>%
group_by(STATE, CountyNo) %>%
summarise(meanIAT = round(mean(IAT), 2),
N = n()) %>%
filter(!(STATE %in% c("AE", "AP", "PR", "AA")) & N > 30)
# Merge state and county fips, then merge again with the data set with names
data(state.fips)
state_fips <- select(state.fips, fips, abb) %>%
distinct(fips, abb) %>%
rbind(data.frame(fips = c(02, 15),
abb = c("AK", "HI"))) %>%
arrange(fips)
county_fips <- left_join(county_agg, state_fips, by = c("STATE" = "abb")) %>%
mutate(id = paste0(as.character(fips), as.character(CountyNo)))
county_names <- read.csv("county_names.csv")
county_total <- merge(county_names, county_fips, all.x = TRUE) %>%
select(id, name, mean_IAT)
county_total
county_agg <- do.call(rbind, new_data) %>%
group_by(STATE, CountyNo) %>%
summarise(meanIAT = round(mean(IAT), 2),
N = n()) %>%
filter(!(STATE %in% c("AE", "AP", "PR", "AA")) & N > 30)
# Merge state and county fips, then merge again with the data set with names
data(state.fips)
state_fips <- select(state.fips, fips, abb) %>%
distinct(fips, abb) %>%
rbind(data.frame(fips = c(02, 15),
abb = c("AK", "HI"))) %>%
arrange(fips)
county_fips <- left_join(county_agg, state_fips, by = c("STATE" = "abb")) %>%
mutate(id = paste0(as.character(fips), as.character(CountyNo)))
county_names <- read.csv("county_names.csv")
county_total <- merge(county_names, county_fips, all.x = TRUE) %>%
select(id, name, meanIAT)
county_total
county_agg <- do.call(rbind, new_data) %>%
group_by(STATE, CountyNo) %>%
summarise(meanIAT = round(mean(IAT), 2),
size = n()) %>%
filter(!(STATE %in% c("AE", "AP", "PR", "AA")) & N > 30)
# Merge state and county fips, then merge again with the data set with names
data(state.fips)
state_fips <- select(state.fips, fips, abb) %>%
distinct(fips, abb) %>%
rbind(data.frame(fips = c(02, 15),
abb = c("AK", "HI"))) %>%
arrange(fips)
county_fips <- left_join(county_agg, state_fips, by = c("STATE" = "abb")) %>%
mutate(id = paste0(as.character(fips), as.character(CountyNo)))
county_names <- read.csv("county_names.csv")
county_fips <- left_join(county_agg, state_fips, by = c("STATE" = "abb")) %>%
mutate(id = paste0(as.character(fips), as.character(CountyNo)))
county_names <- read.csv("county_names.csv")
county_total <- merge(county_names, county_fips, all.x = TRUE) %>%
select(id, name, meanIAT, size)
county_fips
county_agg <- do.call(rbind, new_data) %>%
group_by(STATE, CountyNo) %>%
summarise(meanIAT = round(mean(IAT), 2),
size = n()) %>%
filter(!(STATE %in% c("AE", "AP", "PR", "AA")) & N > 30)
# Merge state and county fips, then merge again with the data set with names
data(state.fips)
state_fips <- select(state.fips, fips, abb) %>%
distinct(fips, abb) %>%
rbind(data.frame(fips = c(02, 15),
abb = c("AK", "HI"))) %>%
arrange(fips)
county_fips <- left_join(county_agg, state_fips, by = c("STATE" = "abb")) %>%
mutate(id = paste0(as.character(fips), as.character(CountyNo)))
county_names <- read.csv("county_names.csv")
county_total <- merge(county_names, county_fips, all.x = TRUE) %>%
select(id, name, meanIAT, size)
county_names
county_fips
county_agg <- do.call(rbind, new_data) %>%
group_by(STATE, CountyNo) %>%
summarise(meanIAT = round(mean(IAT), 2),
size = n()) %>%
filter(!(STATE %in% c("AE", "AP", "PR", "AA")) & N > 30)
county_agg <- do.call(rbind, new_data) %>%
group_by(STATE, CountyNo) %>%
summarise(meanIAT = round(mean(IAT), 2),
size = n()) %>%
filter(!(STATE %in% c("AE", "AP", "PR", "AA")) & size > 30)
# Merge state and county fips, then merge again with the data set with names
data(state.fips)
state_fips <- select(state.fips, fips, abb) %>%
distinct(fips, abb) %>%
rbind(data.frame(fips = c(02, 15),
abb = c("AK", "HI"))) %>%
arrange(fips)
county_fips <- left_join(county_agg, state_fips, by = c("STATE" = "abb")) %>%
mutate(id = paste0(as.character(fips), as.character(CountyNo)))
county_names <- read.csv("county_names.csv")
county_total <- merge(county_names, county_fips, all.x = TRUE) %>%
select(id, name, meanIAT, size)
county_total
county_total <- merge(county_names, county_fips, all.x = TRUE) %>%
select(id, name, meanIAT, size) %>%
na.omit()
county_total
county_total <- merge(county_names, county_fips, all.x = TRUE) %>%
select(id, name, meanIAT, size)
write.csv(county_total, "county_data.csv", row.names = FALSE)
plot(density(foo$rate, na.rm = TRUE))
plot(density(county_total$meanIAT, na.rm = TRUE))
sd_score <- sd(county_total$meanIAT, na.rm = TRUE)
round(c(-2 * sd_score, -1 * sd_score, 0, 1 * sd_score, 2 * sd_score) + mean(county_total$meanIAT, na.rm = TRUE), 2)
state_agg <- do.call(rbind, new_data)
rm(list = ls())
